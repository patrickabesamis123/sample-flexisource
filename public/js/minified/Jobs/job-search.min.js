!function(){"use strict";var e=angular.module("app");$("body").data("base_url");e.filter("cuts",function(){return function(e,a,t,s){if(!e)return"";if(!(t=parseInt(t,10)))return e;if(e.length<=t)return e;if(e=e.replace(/<br[^>]*>/gi,"\n"),e=e.substr(0,t),a){var r=e.lastIndexOf(" ");-1!==r&&(","!==e.charAt(r-1)&&"."!==e.charAt(r-1)||(r-=1),e=e.substr(0,r))}return e+(s||" ...")}}),e.controller("JobSearchController",["GlobalConstant","GlobalSearch","$scope","$window","$http","$cookies","$timeout","$location","$filter",function(e,a,t,s,r,n,l,i,o){function c(){t.autoLocation=[],r.get(e.APIRoot+"static/autocomplete/location?q="+$("#location").val()).then(function(e){t.hideme=!1,t.autoLocation=e.data.data,t.autoLocation.length?$("#autoDataLocation").removeClass("ng-hide"):$("#autoDataLocation").addClass("ng-hide")})}function u(e){return Number(String(e).split(".")[1]||0)}t.jobSearchTemplate="themes/bbt/templates/Layout/Job_template_search.html",t.token=n.get("token"),t.ut=n.get("ut"),t.industries=[];var d=[];d=["member-initials--sky","member-initials--pvm-purple","member-initials--pvm-green","member-initials--pvm-red","member-initials--pvm-yellow"],r.get(e.APIRoot+"static/options/industries/all").then(function(e){t.industries=e.data.data}),t.locationCountry=[],t.locations=[],t.slug_loc="",r.get(e.APIRoot+"static/options/countries").then(function(e){t.locationCountry=e.data.data}),t.filterCountry=function(a){r.get(e.APIRoot+"static/options/locations/"+a+"/combined").then(function(e){t.locations=e.data.data,t.slug_loc=a}),t.selectedSubFilter=!t.selectedSubFilter},t.job_types=[],r.get(e.StaticOptionWorkTypeApi).then(function(e){t.job_types=e.data.data}),t.hideme=!0;var h;$("#location").on("keyup",function(){l.cancel(h),h=l(c,10)}),$("#location").on("keydown",function(){l.cancel(h)}),$("#location").on("change",function(){$("#autoDataLocation .autodata").click(function(){$("#location:text").val($(this).data("value")),$("#autoDataLocation").hasClass("ng-hide")||$("#autoDataLocation").addClass("ng-hide")})}),t.seen=function(a,s){var n=$(a.target);n.attr("data-obj-id");r.post(e.CandidateJobWatchlistApi+"/"+s).then(function(e){e.data.data.watchlist?n.hasClass("pvm-blue")||n.addClass("pvm-blue"):n.removeClass("pvm-blue"),t.GetJobs({params:t.searchDetails[0]})},function(e){})},t.showDetail=function(a,s){$(a.target).attr("data-obj-id");var n=angular.element($(".job"+s)),i=$(".partjob"+s);t.joblisting=[],angular.element($(".partjob")).each(function(){angular.element(this).is(":visible")&&(angular.element(this).hasClass("partjob"+s)?angular.element(this).removeClass("hide"):angular.element(this).addClass("hide"))}),angular.element(i).hasClass("hide")?(angular.element(i).removeClass("hide"),r.get(e.JobsApi+"/"+s).then(function(e){if(200==e.status){var a=e.data.data;t.joblisting=a,l(function(){var e="JobVideo_"+t.joblisting.object_id;if($("#"+e).length){var a=amp(e,{techOrder:["azureHtml5JS","flashSS","silverlightSS","html5"],nativeControlsForTouch:!1,autoplay:!1,controls:!0,width:"100%",logo:{enabled:!1},poster:""},function(){this.addEventListener("ended",function(){})});t.joblisting.job_meta.job_video_url&&a.src([{src:t.joblisting.job_meta.job_video_url,type:"application/vnd.ms-sstr+xml"}])}},1e3),n.removeClass("glyphicon-menu-down"),n.addClass("glyphicon-menu-up"),n.attr("data-seen","true")}},function(e){})):(angular.element(i).addClass("hide"),n.removeClass("glyphicon-menu-up"),n.addClass("glyphicon-menu-down"))},t.checkedBox=function(e){var a=$(e.target);a.hasClass("checkbox-checked")?(a.removeClass("checkbox-checked"),a.addClass("checkbox-uncheck")):(a.addClass("checkbox-checked"),a.removeClass("checkbox-uncheck"))},t.equalArray=function(e,a){return JSON.stringify(e)==JSON.stringify(a)},t.searchDetails=[i.search()],t.jobSearch=[],t.filter={},t.selectedParams={},t.refreshslider=function(){setTimeout(function(){t.$broadcast("reCalcViewDimensions")},500)},t.GetJobs=function(a){var s={params:a.params};if(n.get("token")){l=n.get("token");angular.extend(s,{headers:{Authorization:"Bearer "+l}})}else var l=null;r.get(e.JobsApi+"/search",s).then(function(a){t.jobSearch=a.data.data,t.request_params=t.jobSearch.request_params,t.facets=t.jobSearch.facets;for(y=0;y<t.jobSearch.results.companies.length;y++)t.jobSearch.results.companies[y].encode_company_url=encodeURIComponent(t.jobSearch.results.companies[y].company_url);for(var s=0;s<t.jobSearch.results.jobs.length;s++){var l=t.jobSearch.results.jobs[s].company_name;l=l.replace(/[^A-Z]/g,""),t.jobSearch.results.jobs[s].initial=l;var i=d[Math.floor(Math.random()*d.length)];t.jobSearch.results.jobs[s].profile_color=i}for(var o=0;o<t.jobSearch.results.companies.length;o++){var c=t.jobSearch.results.companies[o].company_name;c=c.replace(/[^A-Z]/g,""),t.jobSearch.results.companies[o].initial=c;var h=d[Math.floor(Math.random()*d.length)];t.jobSearch.results.companies[o].profile_color=h}if(console.log("jobsssss: ",t.jobSearch.results.companies),t.selectedParams.industry=[],t.selectedParams.sub_industry=[],t.selectedParams.role_type=[],t.selectedParams.state=[],t.selectedParams.area=[],t.iSindustry=[],t.iSsub_industry=[],t.iSrole_type=[],t.iSstate=[],t.iSCountry=[],t.filter.industry=[],t.filter.sub_industry=[],t.filter.role_type=[],t.filter.state=[],t.filter.area=[],t.selectedMainFilter=!1,t.selectedMainFilter2=!1,t.selectedMainFilter3=!1,t.selectedMainFilter4=!1,t.selectedSubFilter=!1,0!=t.request_params.length)if(angular.forEach(t.request_params,function(e,a){if(angular.isArray(e))angular.forEach(e,function(e,s){switch(a){case"industry":t.selectedParams.industry.push(parseInt(e));break;case"sub_industry":t.selectedParams.sub_industry.push(parseInt(e));break;case"state":t.selectedParams.state.push(parseInt(e));break;case"area":t.selectedParams.area.push(parseInt(e));break;case"role_type":t.selectedParams.role_type.push(parseInt(e))}});else switch(a){case"min_salary":t.selectedParams.min_salary=e;break;case"max_salary":t.selectedParams.max_salary=e}}),angular.isDefined(t.selectedParams.min_salary)&&angular.isDefined(t.selectedParams.max_salary))var f=t.selectedParams.min_salary,m=t.selectedParams.max_salary;else var f=0,m=2e5;else var f=0,m=2e5;if(angular.forEach(t.facets,function(e,a){angular.forEach(e.values,function(e,s){switch(a){case"industry":t.filter.industry.push({parent_id:parseInt(s),count:e});break;case"sub_industry":t.filter.sub_industry.push({sub_id:parseInt(s),count:e});break;case"state":t.filter.state.push({parent_id:parseInt(s),count:e});break;case"area":t.filter.area.push({parent_id:parseInt(s),count:e})}})}),angular.isDefined(t.jobSearch.pagination.limit)){var g=t.jobSearch.num_found/t.jobSearch.pagination.limit,p=Math.round(10*g)/10,b=u(p);t.pagenationLength=b<=4?Math.round(p)+1:Math.round(p),t.paginatelength=[];for(var y=0;y<t.pagenationLength;)t.paginatelength.push(y),y++}t.slider={minValue:f,maxValue:m,options:{floor:0,ceil:2e5,step:1e3,translate:function(e){var a=e.toString();switch(a.length){case 4:t=a;break;case 5:t=a.substring(0,2)+"K";break;case 6:t=a.substring(0,3)+"K";break;default:var t=0}return"200K"==t&&(t+="+"),"$"+t}}},t.selectedParams.state||(t.loadcity=!0),t.selectedParams.industry.length>0||t.selectedParams.sub_industry.length>0?t.selectedMainFilter=!0:t.selectedMainFilter=!1,t.selectedParams.role_type.length>0?t.selectedMainFilter2=!0:t.selectedMainFilter2=!1,t.iSCountry=[],t.selectedParams.state.length>0?t.selectedMainFilter3=!0:t.selectedMainFilter3=!1,t.selectedParams.max_salary>0?t.selectedMainFilter4=!0:t.selectedMainFilter4=!1,t.followedText="+ Follow us",n.get("token")&&"candidate"==t.ut&&angular.forEach(t.jobSearch.results.companies,function(a,s){r.get(e.APIRoot+"candidate/company/follow/"+a.id).then(function(e){e.data.data.followed?(t.following=!0,angular.element($(".f_"+a.id)).show(),angular.element($(".uf_"+a.id)).hide(),angular.element($("#comp_"+a.id).addClass("following"))):(t.following=!1,angular.element($(".f_"+a.id)).hide(),angular.element($(".uf_"+a.id)).show(),angular.element($("#comp_"+a.id).removeClass("following")))})}),t.checkAll=function(a){1==angular.element($(".selectAll_"+a+":checkbox:checked")).length?r.get(e.APIRoot+"static/options/locations/cities/"+a).then(function(e){var a=e.data.data;t.childrencity=[],angular.forEach(a,function(e,a){t.childrencity.push(e.id)}),t.selectedParams.city=angular.copy(t.childrencity)}):t.selectedParams.city=angular.copy([])},t.unCheckAll=function(e,a){1==angular.element($(".selectAll_"+e+":checkbox:checked")).length&&("industry"==a?t.selectedParams.sub_industry=[]:"location"==a&&(t.selectedParams.area=[]))},t.refreshslider()})},t.UpdateSalary=function(){angular.extend(t.searchDetails[0],{min_salary:t.slider.minValue}),angular.extend(t.searchDetails[0],{max_salary:t.slider.maxValue}),i.search("min_salary",t.slider.minValue),i.search("max_salary",t.slider.maxValue),t.GetJobs({params:t.searchDetails[0]})},t.clearFilter=function(){angular.forEach(t.searchDetails[0],function(e,a){var s="{"+a+": ''}",r=angular.toJson(s,!0);angular.extend(t.searchDetails[0],r)}),t.GetJobs({params:t.searchDetails[0]})},t.first=function(e){i.search("offset",0),delete t.searchDetails[0].offset,t.searchDetails[0].offset=0,t.GetJobs({params:t.searchDetails[0]}),angular.element($("html, body")).animate({scrollTop:0},1e3)},t.activeClass=function(e){if(e==t.searchDetails[0].offset)return"activepage"},t.last=function(e,a){var s=Math.round(10*e)/10;if(u(s)<=4)r=Math.round(s)+1;else var r=Math.round(s);var n=(r-1)*a;i.search("offset",n),delete t.searchDetails[0].offset,t.searchDetails[0].offset=parseInt(n),t.GetJobs({params:t.searchDetails[0]}),angular.element($("html, body")).animate({scrollTop:0},1e3)},t.prev=function(e){var a=parseInt(t.searchDetails[0].offset)-parseInt(e);i.search("offset",a),delete t.searchDetails[0].offset,t.searchDetails[0].offset=parseInt(a),t.GetJobs({params:t.searchDetails[0]}),angular.element($("html, body")).animate({scrollTop:0},1e3)},t.gotooffset=function(e){i.search("offset",e),delete t.searchDetails[0].offset,t.searchDetails[0].offset=parseInt(e),t.GetJobs({params:t.searchDetails[0]}),angular.element($("html, body")).animate({scrollTop:0},1e3)},t.next=function(e){var a=parseInt(t.searchDetails[0].offset)+parseInt(e);i.search("offset",a.toString()),delete t.searchDetails[0].offset,t.searchDetails[0].offset=parseInt(a),t.GetJobs({params:t.searchDetails[0]}),angular.element($("html, body")).animate({scrollTop:0},1e3)},t.follow=function(a){n.get("token");r.post(e.CandidateRootApi+"/company/follow/"+a).then(function(e){e.data.data.followed?(angular.element($(".f_"+a)).show(),angular.element($(".uf_"+a)).hide(),angular.element($("#comp_"+val.id).addClass("following"))):(angular.element($(".f_"+a)).hide(),angular.element($(".uf_"+a)).show(),angular.element($("#comp_"+val.id).removeClass("following")))},function(e){})},angular.isDefined(t.searchDetails[0])&&(t.GetJobs({params:t.searchDetails[0]}),t.refreshslider()),t.$watch(function(){return a.getSearchVal()},function(e,a){e!==a&&(angular.extend(t.searchDetails[0],{q:e}),t.GetJobs({params:t.searchDetails[0]}),i.search("q",e))}),t.searchJob=function(){if(angular.isUndefined(t.searchJobId))return!1;"0"!=i.search().offset&&(i.search("offset",0),console.log("test"),delete t.searchDetails[0].offset,t.searchDetails[0].offset=0),angular.extend(t.searchDetails[0],{q:t.searchJobId}),t.GetJobs({params:t.searchDetails[0]}),angular.forEach(t.searchDetails[0],function(e,a){angular.isArray(e)?(0!==e.length?i.search(a,e.toString()):e.length,i.search(a,null)):0!==e.length?i.search([a],e.toString()):i.search(a,null)})},t.removeTag=function(e,a){angular.isArray(e)?angular.forEach(e,function(e,a){angular.forEach(t.selectedParams,function(s,r){if(r==e){delete t.selectedParams[r],delete t.searchDetails[0][r];var n="{"+a+": null}",l=angular.toJson(n,!0);i.search(l)}})}):"q"==e?(delete t.searchDetails[0].q,t.GetJobs({params:t.searchDetails[0]}),t.refreshslider(),i.search("q",null)):"company_name"==e?(delete t.searchDetails[0].company_name,t.GetJobs({params:t.searchDetails[0]}),t.refreshslider(),i.search("company_name",null)):angular.forEach(t.selectedParams,function(t,s){if(s==e){var r=t.indexOf(a);t.splice(r,1)}})},t.FindParent=function(e,a){if("industry"==a)s=t.selectedParams.industry.indexOf(e);else if("location"==a)var s=t.selectedParams.state.indexOf(e);if(angular.element($(".selectAll_"+e)).is(":checked")&&angular.element($(".selectAll_"+e)).attr("checked",!1),-1==s){var r=e.toString();"industry"==a?0!=t.selectedParams.industry.length?(delete t.searchDetails[0].industry,angular.extend(t.searchDetails[0],{industry:t.selectedParams.industry+","+r})):(delete t.searchDetails[0].industry,angular.extend(t.searchDetails[0],{industry:r})):"location"==a&&(0!=t.selectedParams.state.length?(delete t.searchDetails[0].state,angular.extend(t.searchDetails[0],{state:t.selectedParams.region+","+r})):(delete t.searchDetails[0].state,angular.extend(t.searchDetails[0],{state:r}))),t.GetJobs({params:t.searchDetails[0]})}return!1},t.uncheckSubs=function(e,a){if(t.findsubs=[],"industry"==a){n=o("filter")(t.industries,{id:e},!0);if(!angular.element($("#industry_"+e.toString())).is(":checked")){angular.forEach(n,function(e,a){angular.forEach(t.selectedParams.sub_industry,function(a,s){var r=o("filter")(e.sub,{id:a},!0);0!=r.length&&t.findsubs.push(r[0].id)})});var s=t.findsubs,r=t.searchDetails[0].sub_industry.split(",");return angular.forEach(s,function(e,a){var t=r.indexOf(e.toString());r.splice(t,1)}),delete t.searchDetails[0].sub_industry,angular.extend(t.searchDetails[0],{sub_industry:r.toString()}),angular.element($(".selectAll_"+e)).attr("checked",!1),t.GetJobs({params:t.searchDetails[0]}),!1}}else if("location"==a){var n=o("filter")(t.locations,{id:e},!0);if(!angular.element($("#region_"+e.toString())).is(":checked")){angular.forEach(n,function(e,a){angular.forEach(e.location,function(e,a){angular.forEach(t.selectedParams.area,function(a,s){var r=o("filter")(e.area,{id:a},!0);0!=r.length&&t.findsubs.push(r[0].id)})})});var s=t.findsubs,r=t.searchDetails[0].area.split(",");return angular.forEach(s,function(e,a){var t=r.indexOf(e.toString());r.splice(t,1)}),delete t.searchDetails[0].area,angular.extend(t.searchDetails[0],{area:r.toString()}),angular.element($(".selectAll_"+e)).attr("checked",!1),t.GetJobs({params:t.searchDetails[0]}),!1}}},t.$watch("selectedParams",function(e,a){if(0==t.equalArray(a,e)&&angular.isDefined(a)){var s=i.search();return angular.isUndefined(s.offset)&&(i.search("offset",0),delete t.searchDetails[0].offset,t.searchDetails[0].offset=0),angular.forEach(e,function(e,a){if(angular.isArray(e))if(0!=e.length){i.search(a,e.toString()),(s=JSON.parse("{ }"))[a]=e.toString();r=angular.toJson(s,!0);angular.extend(t.searchDetails[0],JSON.parse(r))}else{i.search([a],null),(s=JSON.parse("{ }"))[a]=e.toString();r=angular.toJson(s,!0);angular.extend(t.searchDetails[0],JSON.parse(r))}else if(0!=e.length){i.search([a],e.toString());var s=JSON.parse("{ }");s[a]=e.toString();var r=angular.toJson(s,!0);angular.extend(t.searchDetails[0],JSON.parse(r))}}),t.refreshslider(),t.GetJobs({params:t.searchDetails[0]}),!1}},!0),t.loadcity=!0,t.filterRegion=function(a){t.filteredlocations=[],t.loadcity=!1,angular.element($(".locationFilterContainer")).css("right","-620px"),r.get(e.APIRoot+"static/options/locations/nz/combined").then(function(e){var s=e.data.data,r=o("filter")(s,{id:a},!0);t.filteredlocations=r,t.activeLocation=r[0].id,t.loadcity=!0})},t.filterIndustries=function(a){t.filteredindutries=[],t.loadsubind=!1,t.activeItem=a,angular.element($(".IndustryFilterContainer")).css("right","-610px"),r.get(e.APIRoot+"static/options/industries/all").then(function(e){var s=e.data.data,r=o("filter")(s,{id:a},!0);t.filteredindutries=r,t.loadsubind=!0})},t.SortJobSearch=function(e){"job"==e?(t.jobstyle={order:1},t.comapnystyle={order:2}):"company"==e&&(t.jobstyle={order:2},t.comapnystyle={order:1})}}])}(),$(document).ready(function(){if($(".listcontainer, .job-filter__scroll").TrackpadScrollEmulator(),$("#min").text($("#min_salary2").val()),$("#max").text($("#max_salary2").val()+"k"),$("#min_year").text($("#min_y").val()),$("#max_year").text($("#max_y").val()+"y+"),$("#min_salary2").on("change",function(e){e.preventDefault();var a=$(this).val();a=a>0?a+"k":a,$("#min").text(a)}),$("#max_salary2").on("change",function(e){e.preventDefault();var a=$(this).val();a=a>0?a+"k":a,$("#max").text(a)}),$("#min_y").on("change",function(e){e.preventDefault();var a=$(this).val();a=a>0?10==a?a+"y+":a+"y":a,$("#min_year").text(a)}),$("#max_y").on("change",function(e){e.preventDefault();var a=$(this).val();a=a>0?10==a?a+"y+":a+"y":a,$("#max_year").text(a)}),$(".openFilter").click(function(){$(".FilterContent").slideToggle("slow",function(){$("#right-container").length&&($(".FilterContent").is(":visible")?$(".FilterContent").attr("data-is_visible","true"):$(".FilterContent").attr("data-is_visible","false"))}),$("#right-container").length&&("false"==$(".FilterContent").attr("data-is_visible")?$("#right-container .ui-rangeslider").css("visibility","hidden"):$("#right-container .ui-rangeslider").css("visibility",""))}),$("#job-search-container #filter_by").click(function(){$(".filterOption").slideToggle("slow")}),$(".filterOption").mouseleave(function(){$(this).is(":visible")&&$(this).slideUp("slow")}),$("#job-search-filter-content").length){var e=$("#min_salary3").val(),a=$("#max_salary3").val();$("#slider-range .ui-slider-handle:first").addClass("min").html('<div class="valueslider">$'+e+"</div>"),$("#slider-range .ui-slider-handle:last").addClass("max").html('<div class="valueslider">$'+a.toString().substring(0,3)+"K</div>"),$("#min_salary3").on("change",function(){var e=$("#slider-range .ui-slider-handle:first").attr("aria-valuenow"),a=e.toString();switch(a.length){case 4:t=a;break;case 5:t=a.substring(0,2)+"K";break;case 6:t=a.substring(0,3)+"K";break;default:var t=0}$("#slider-range .ui-slider-handle:first").html('<div class="valueslider">$'+t+"</div>"),$("#min_salary3").val(e)}),$("#max_salary3").on("change",function(){var e=$("#slider-range .ui-slider-handle:last").attr("aria-valuenow"),a=e.toString();switch(a.length){case 4:t=a.substring(0,1)+"K";break;case 5:t=a.substring(0,2)+"K";break;case 6:t=a.substring(0,3)+"K";break;default:var t="500K"}$("#slider-range .ui-slider-handle:last").html('<div class="valueslider">$'+t+"</div>"),$("#max_salary3").val(e)})}});