!function(){"use strict";function e(e,t,a){for(var o=0;o<e.length;o++)if(e[o][t]==a)return o;return null}var t=angular.module("app"),a=$("body").data("base_url");$(".industry_multi_holder").TrackpadScrollEmulator(),t.directive("shareCount",["$http","GlobalConstant","IdentifierBridge",function(e,t,a){return{restrict:"EA",scope:{src:"=?bind"},replace:!0,link:function(o,i,n){i.bind("click",function(){o.src=n.name;var i={role_id:a.get(),type:o.src};e.post(t.EmployerRootApi+"/sourceclicks",i).then(function(e){return console.log("Share success")})})}}}]),t.service("IdentifierBridge",function(){var e;return{get:function(){return e},set:function(t){e=t}}}),t.controller("JoblistingController",["GlobalConstant","$scope","$window","$http","$cookies","$compile","IdentifierBridge",function(e,t,o,i,n,r,d){var s=$("#job-listing-id").val();s=$.trim(s.replace(/\/$/,""));var l=n.get("token");t.ut=n.get("ut");var c=[];c=["member-initials--sky","member-initials--pvm-purple","member-initials--pvm-green","member-initials--pvm-red","member-initials--pvm-yellow"],t.ellipsesText=function(e){return'<span title="'+e+'">...</span>'},t.joblistingPrintTemplate="themes/bbt/templates/Layout/Job_listing_print_template.html",t.hideMe=!0,t.base_url=a,s&&(t.params={access_token:l},i.get(e.JobsApi+"/"+s).then(function(r){if(200==r.status){var p=r.data.data;p.min_salary&&(p.min_salary=p.min_salary/1e3+"k"),p.max_salary&&(p.max_salary=p.max_salary/1e3+"k");var u=["padding-l-zero pull-left","more-listing2 pull-left","padding-r-zero pull-right"],m=0;angular.isDefined(p.company_extra_data.active_jobs.results.jobs)&&p.company_extra_data.active_jobs.results.jobs.length&&angular.forEach(p.company_extra_data.active_jobs.results.jobs,function(e,a){e.myclass=u[m],e.limit_description=e.description.length<200?e.description:e.description.substr(0,200)+t.ellipsesText(e.description),e.job_title_limit=e.job_title.length<20?e.job_title:e.job_title.substr(0,20)+t.ellipsesText(e.job_title),e.company_name_limit=e.company_name.length<33?e.company_name:e.company_name.substr(0,33)+t.ellipsesText(e.company_name),2==m&&(m=0),m++}),t.joblisting=p,d.set(t.joblisting.object_id),t.comp_initial=t.joblisting.company.company_name,t.comp_initial=t.comp_initial.replace(/[^A-Z]/g,""),t.joblisting.company.initial=t.comp_initial;var f=c[Math.floor(Math.random()*c.length)];if(t.joblisting.company.profile_color=f,$("#joblisting_title").html(t.joblisting.job_title+" | PreviewMe"),t.company_website="",t.joblisting.company.website_url&&(t.company_website=t.joblisting.company.website_url.replace(/^https?:\/\//,"")),p.company.company_video&&(t.showVideo=!!p.company.company_video.doc_url),t.showVideoTop=void 0!==p.job_meta.job_video_url,t.showVideoTop&&""!=p.job_meta.job_video_url){var _,v,h=0,g=amp("vid1",{techOrder:["azureHtml5JS","flashSS","silverlightSS","html5"],nativeControlsForTouch:!1,autoplay:!1,controls:!0,width:"100%",logo:{enabled:!1},poster:""},function(){this.addEventListener("ended",function(){console.log("(ended): ",this.currentTime())}),this.addEventListener("midpoint",function(){console.log("(midpoint): ",this.currentTime())}),this.addEventListener("firstquartile",function(){console.log("(firstquartile): ",this.currentTime())}),this.addEventListener("start",function(){h=this.duration(),_=parseInt(h,10),v=(_/=60)%1,_=parseInt(_,10),v=v.toFixed(2),v*=.6,v=Math.round(100*v)/100,h=_+v})});p.job_meta.job_video_url?g.src([{src:p.job_meta.job_video_url,type:"application/vnd.ms-sstr+xml"}]):(t.showVideoTop=!1,t.showVideoLoding=!0)}else t.showVideoTop=!1;if(p.company.company_video&&"0"!=p.company.company_video.doc_url){var w=amp("vid2",{techOrder:["azureHtml5JS","flashSS","silverlightSS","html5"],nativeControlsForTouch:!1,autoplay:!1,controls:!0,width:"100%",logo:{enabled:!1},poster:""},function(){this.addEventListener("ended",function(){})});p.company.company_video.doc_url?w.src([{src:p.company.company_video.doc_url,type:"application/vnd.ms-sstr+xml"}]):(t.showVideoLoding2=!1,t.showVideoTop=!1)}t.followedText="+ Follow us",l&&"candidate"==t.ut?(i.get(e.APIRoot+"candidate/company/follow/"+t.joblisting.company.id).then(function(e){e.data.data.followed?t.followedText="- Unfollow":t.followedText="+ Follow us"}),t.follow=function(a){i.post(e.CandidateRootApi+"/company/follow/"+a).then(function(e){var a=parseInt(t.joblisting.company_extra_data.followers);e.data.data.followed?(t.joblisting.company_extra_data.followers=a+1,t.followedText="- Unfollow"):(t.joblisting.company_extra_data.followers=a-1,t.followedText="+ Follow us")},function(e){})}):t.follow=function(e){return!1},t.ApplyJob=function(){l&&"candidate"==t.ut?(i.post(e.CandidateRootApi+"/application/"+s).then(function(e){n.put("jobObjectId",s,{path:"/"}),n.put("applicationId",e.data.data.application_id,{path:"/"}),n.put("nextStep",e.data.data.next_step,{path:"/"});var i=angular.toJson(e.data.data.all_steps);n.put("availSteps",i,{path:"/"}),n.put("applied_company",t.joblisting.company.company_name,{path:"/"}),o.location.href=a+"job/application?id="+e.data.data.application_id},function(e){t.ErrorMsg=e.data.message,alert("Applied"),$(".job-listing-question-button").attr("disabled",!0),t.noerror=!0}),i.post(e.CandidateRootApi+"/company/follow/"+t.joblisting.company.id).then(function(e){var a=parseInt(t.joblisting.company_extra_data.followers);e.data.data.followed?(t.joblisting.company_extra_data.followers=a+1,t.followedText="- Unfollow"):(t.joblisting.company_extra_data.followers=a-1,t.followedText="+ Follow us")},function(e){})):i.post(e.CandidateRootApi+"/application/"+s).then(function(e){},function(e){})}}},function(e){404==e.status&&(window.location=a+404)}),t.watchlist_text="SAVE TO WATCHLIST",l&&(t.save_to_watchlist=function(){i.post(e.CandidateJobWatchlistApi+"/"+s).then(function(e){e.data.data.watchlist?($(".watchlist_save").addClass("pvm-blue"),t.watchlist_text="SAVED TO WATCHLIST"):$(".watchlist_save").removeClass("pvm-blue")},function(e){})},"employer"!=t.ut&&i.get(e.CandidateJobWatchlistApi).then(function(e){var a=e.data.data;angular.forEach(a.jobs,function(e,a){e.object_id==s&&($(".watchlist_save").addClass("pvm-blue"),t.watchlist_text="SAVED TO WATCHLIST")})}),i.get(e.JobsApi+"/"+s).then(function(e){var a=e.data.data;a.candidate&&(t.applied=a.candidate.application.applied)}),t.openEmail=function(){$("#joblistingEmailModal").modal("show")},t.joblistSendEmail=function(){var a={data:{sender_name:t.sender_name,sender_email:t.sender_email,receiver_name:t.receiver_name,receiver_email:t.receiver_email}};i.post(e.APIRoot+"jobs/"+t.joblisting.object_id+"/share/email",a).then(function(e){alert("Message sent."),$("#joblistingEmailModal").modal("hide")},function(e){alert("error")})})),t.printJoblisting=function(){var e=window.open();e.document.write($("#joblisting-printTemplate").html()),e.document.close(),e.focus(),e.print(),e.close()}}]),t.controller("JobApplication",["GlobalConstant","fileUploadService","$scope","$window","$http","$cookies","$location","$timeout",function(t,o,i,n,r,d,s,l){function c(e,t){for(var a,o=(t||window.location.search.substring(1)).split(/[&||?]/),i=0;i<o.length;i+=1){var n=(o[i]||"").split("=");n[0]===e&&(a=n[1])}return a}function p(){navigator.appVersion;var e=navigator.userAgent;i.browserName=navigator.appName;var t,a,o,n=""+parseFloat(navigator.appVersion),r=parseInt(navigator.appVersion,10);-1!=(a=e.indexOf("Opera"))?(i.browserName="Opera",n=e.substring(a+6),-1!=(a=e.indexOf("Version"))&&(n=e.substring(a+8))):-1!=(a=e.indexOf("MSIE"))?(i.browserName="IE",n=e.substring(a+5)):-1!=(a=e.indexOf("Chrome"))?(i.browserName="Chrome",n=e.substring(a+7)):-1!=(a=e.indexOf("Safari"))?(i.browserName="Safari",n=e.substring(a+7),-1!=(a=e.indexOf("Version"))&&(n=e.substring(a+8))):-1!=(a=e.indexOf("Firefox"))?(i.browserName="Firefox",n=e.substring(a+8)):(t=e.lastIndexOf(" ")+1)<(a=e.lastIndexOf("/"))&&(i.browserName=e.substring(t,a),n=e.substring(a+1),browserName.toLowerCase()==browserName.toUpperCase()&&(i.browserName=navigator.appName)),-1!=(o=n.indexOf(";"))&&(n=n.substring(0,o)),-1!=(o=n.indexOf(" "))&&(n=n.substring(0,o)),r=parseInt(""+n,10),isNaN(r)&&(n=""+parseFloat(navigator.appVersion),r=parseInt(navigator.appVersion,10)),$("body").addClass(i.browserName+" "+i.browserName+"-"+r)}i.isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,i.clickHandler=function(e){if(13==e.keyCode)e.preventDefault();else{var t="object"==typeof e?e.target:document.getElementById(e),a=t.scrollHeight;t.style.height=a+"px"}};var u=d.get("token"),m=c("id"),f=d.get("token_id");if(i.nextStep=d.get("nextStep"),i.noerror=!1,c("job_id"))_=c("job_id");else var _=d.get("jobObjectId");if(c("next_step")&&(i.nextStep=c("next_step")),null!=u||0==angular.isUndefined(u))if(null!=m||0==angular.isUndefined(m)){if(i.noerror=!1,r.get(t.JobsApi+"/"+_).then(function(e){i.companyDetails=e.data.data}),"applied"!=i.nextStep||"rejected"!=i.nextStep){if(i.leftItems=[],angular.isDefined(c("id"))&&angular.isDefined(c("job_id")))r.get(t.CandidateRootApi+"/application/"+c("job_id")+"/"+c("id")).then(function(e){i.all_steps=e.data.data.all_steps,i.currentStep=i.nextStep,angular.forEach(i.all_steps,function(e,t){"pre_apply_questions"==e?i.leftItems.push({name:"START YOUR APPLICATION",slug:e}):"requirements_check"==e?(i.leftItems.push({name:"COMPLETE YOUR PROFILE",slug:e}),l(function(){angular.element($(".appstep_"+(t-1))).addClass("progtrckr-done"),angular.element($(".appstep_"+(t-1))).removeClass("progtrckr-todo")},200)):"application_questions"==e&&(i.leftItems.push({name:"APPLICATION QUESTIONS",slug:e}),l(function(){angular.element($(".appstep_"+(t-1))).addClass("progtrckr-done"),angular.element($(".appstep_"+(t-1))).removeClass("progtrckr-todo"),angular.element($(".appstep_"+(t-2))).addClass("progtrckr-done"),angular.element($(".appstep_"+(t-2))).removeClass("progtrckr-todo")},200))})},function(e){i.ErrorMsg=e.data.message,i.noerror=!0});else{i.currentStep=i.nextStep;var v=angular.fromJson(d.get("availSteps"));angular.forEach(v,function(e,t){"pre_apply_questions"==e?i.leftItems.push({name:"START YOUR APPLICATION",slug:e}):"requirements_check"==e?(i.leftItems.push({name:"COMPLETE YOUR PROFILE",slug:e}),l(function(){angular.element($(".appstep_"+(t-1))).addClass("progtrckr-done"),angular.element($(".appstep_"+(t-1))).removeClass("progtrckr-todo")},200)):"application_questions"==e&&(i.leftItems.push({name:"APPLICATION QUESTIONS",slug:e}),l(function(){angular.element($(".appstep_"+(t-1))).addClass("progtrckr-done"),angular.element($(".appstep_"+(t-1))).removeClass("progtrckr-todo"),angular.element($(".appstep_"+(t-2))).addClass("progtrckr-done"),angular.element($(".appstep_"+(t-2))).removeClass("progtrckr-todo")},200))})}i.getStepData=function(){r.get(t.CandidateRootApi+"/application/"+_+"/"+m+"/"+i.nextStep).then(function(e){i.questions=e.data.data},function(e){})},i.getStepData(),i.showsections=function(){var e={pre_apply_questions:!1,requirements_check:!1,application_questions:!1,applied:!1,rejected:!1};return angular.forEach(e,function(t,a){a==i.currentStep&&(e[i.currentStep]=!0)}),e}}if(i.preapply=!0,i.requirementcheck=!1,i.applicationquestions=!1,i.success=!1,i.fail=!1,"pre_apply_questions"==i.nextStep)i.preapply=!0,i.requirementcheck=!1,i.applicationquestions=!1,i.success=!1,i.fail=!1,i.PreApplyQuestions=[],i.SubmitPreApplyQuestion=function(){i.toSubmit=[],angular.forEach(i.PreApplyQuestions.data,function(e,t){var a={question_id:parseInt(t),answer:e};i.toSubmit.push(a)});var e={data:i.toSubmit};if(_)o="&job_id="+_;else var o="";r.post(t.CandidateRootApi+"/application/"+_+"/"+m+"/"+i.nextStep,e).then(function(e){return d.put("nextStep",e.data.data.next_step,{path:"/"}),n.location.href=a+"job/application?id="+m+o+"&next_step="+e.data.data.next_step,!1},function(e){})};else if("requirements_check"==i.nextStep){if(i.preapply=!1,i.requirementcheck=!0,i.applicationquestions=!1,i.success=!1,i.status=!1,r.get(t.CandidateRootApi+"/profile").then(function(e){i.references=e.data.data.references,i.educations=e.data.data.qualifications}),i.getStepData(),i.updateaboutsuc=!1,i.updateaboutrotate=!1,i.updateabouterr=!1,i.ResumeURL="",i.DisplayResumeURL="",i.file_save=function(e){$(e.currentTarget);if(o.save(i),i.isPortfolioSupportingDoc)return i.PortfolioName=i.return_data.file_name,i.showPortfolioDoc=!0,!1;i.ResumeURL=i.return_data},i.$watch("ResumeURL",function(e,t){if(t!=e){i.DisplayResumeURL=e;var a=i.questions.indexOf("resume");-1!=a&&i.questions.splice(a,1)}}),i.$watch("PortfolioName",function(e,t){if(t!=e){i.DisplayResumeURL=e;var a=i.questions.indexOf("portfolio");-1!=a&&i.questions.splice(a,1)}}),i.UpdateProfile=function(e){var a={data:{}};switch(e){case"about":if(null==i.aboutfield||""==i.aboutfield||void 0==i.aboutfield)return i.notcomplete=!1,!1;a.data.long_description=i.aboutfield,i.updateabouterr=!1,i.updateaboutrotate=!0;break;case"phone":if(null==i.phoneField||""==i.phoneField||void 0==i.phoneField)return i.notcomplete=!1,!1;a.data.phone_number=i.phoneField,i.updatephoneerr=!1,i.updatephonerotate=!0}r.put(t.profileApi,a).then(function(t){switch(e){case"about":i.updateaboutrotate=!1;a=i.questions.indexOf("about_me");t.status,i.updateabouterr=!1,i.updateaboutsuc=!0;break;case"phone":i.updatephonerotate=!1;var a=i.questions.indexOf("phone_number");t.status,i.updatephoneerr=!1,i.updatephonesuc=!0}-1!=a&&i.questions.splice(a,1)},function(e){alert("some error")})},i.params={access_token:u},i.AddReferenceForm=function(){i.showReferenceForm=!0},i.CancelReferenceForm=function(){i.showReferenceForm=!1},i.AddEducationForm=function(){i.showEducationForm=!0},i.CancelEducationForm=function(){i.showEducationForm=!1},i.AddReference=function(){var e={};$("#addReferenceForm").serializeArray().map(function(t){"company_name_ref"==t.name&&(t.name="company_name"),e[t.name]=t.value}),r.post(t.ReferenceApi,{data:e}).then(function(e){if(201==e.status){alert("data saved");var t=e.data.data,a={employer_name:t.employer_name,id:t.id,company_name:t.company_name,description:t.description};i.references.push(a),i.showReferenceForm=!1,i.getStepData()}},function(e){alert("Error found: Please review form")})},i.deleteReference=function(e){var a=t.ReferenceApi+"/"+e;r.delete(a).then(function(){$("#ref_"+e).slideToggle(),i.getStepData()})},i.EditReference=function(e,a){r.put(t.ReferenceApi+"/"+a,{data:e}).then(function(e){alert("data saved")},function(e){alert("Error found: Please review form")})},i.qualification=5,i.qualification_provider=1,i.qualifications=[],r.get(t.StaticOptionsApi+"/qualifications").then(function(e){i.qualifications=e.data.data}),i.qualification_providers=[],r.get(t.StaticOptionsApi+"/qualification_providers").then(function(e){i.qualification_providers=e.data.data}),i.initDatePicker=function(e){$(e.target).datetimepicker({timepicker:!1,format:"d-m-Y"}),$(e.target).datetimepicker("show")},i.openDatePicker=function(){$(".my_datapicker").datepicker({dateFormat:"dd-mm-yy"}),$(".my_datapicker").datepicker("show")},i.closePicker=function(){i.picker.opened=!1},i.AddEducation=function(){var e={},a=$("#addEductionForm");a.serializeArray().map(function(t){e[t.name]=t.value,"completed_date"==t.name?e[t.name]=i.parse_view_date(t.value):"qualification"!=t.name&&"qualification_provider"!=t.name||a.find('input[name="'+t.name+'"]').attr("data-id")&&(e[t.name]=parseInt(a.find('input[name="'+t.name+'"]').attr("data-id")))}),"Other"==e.degree&&(e.degree=e.otherDegree),e.edi_current_study&&(e.completed_date=null),r.post(t.EducationApi,{data:e}).then(function(e){if(201==e.status){alert("data saved");var t=e.data.data;i.educations.push(t),i.getStepData(),a.find(':input:not([type="submit"])').val(""),a.find(':input:not([type="submit"])').removeClass("ng-touched"),a.find(':input:not([type="submit"])').addClass("ng-untouched"),a.find("#edi_current_study").prop("checked",!1),i.showEducationForm=!1,i.hideOther=!0;var o=i.questions.indexOf("education");i.questions.splice(o,1)}},function(e){alert("Error found: Please review form")})},i.delete_education=function(e){var a=t.EducationApi+"/"+e;r.delete(a).then(function(){$("#edu_"+e).slideToggle(),i.getStepData()})},i.parse_view_date=function(e){return e?(e=e.split("-"),e=e[2]+"-"+e[1]+"-"+e[0]):null},i.EditEducation=function(e,a){var o={qualification:e.qualification.id,qualification_provider:e.qualification_provider.id,completed_date:i.parse_view_date(e.completed_date)};r.put(t.EducationApi+"/"+a,{data:o}).then(function(e){alert("data saved")},function(e){alert("Error found: Please review form")})},document.EditEducation=function(e){var a=$(e),o=e.id;o=o.split("_"),o=o[2];n=[];a.serializeArray().map(function(e){n[e.name]=e.value,a.find('input[name="'+e.name+'"]').attr("data-id")&&(n[e.name]=parseInt(a.find('input[name="'+e.name+'"]').attr("data-id")))}),"Other"==n.degree&&(n.degree=n.otherDegree),n.edi_current_study&&(n.completed_date=null);var n={qualification:n.qualification,completed_date:n.completed_date,qualification_provider:n.qualification_provider,degree:n.degree};r.put(t.EducationApi+"/"+o,{data:n}).then(function(e){var t=e.data.data;angular.forEach(i.educations,function(e,a){e.id==o&&(e.qualification.display_name=t.qualification.display_name,e.qualification.id=t.qualification.id,e.completed_date=t.completed_date,e.qualification_provider.provider_display_name=t.qualification_provider.provider_display_name,e.qualification_provider.company_logo=t.qualification_provider.company_logo,e.qualification_provider.id=t.qualification_provider.id,e.degree=t.degree)}),a.prev().removeClass("hide"),a.addClass("hide")},function(e){alert("Error found: Please review form")})},r.get(t.StaticOptionsQualificationProvidersApi).then(function(e){i.qualificationProviders=e.data.data}),i.getSelectedDegrees=function(e){return-1!==i.getDegrees.indexOf(e)},i.getDegrees=["High School","Associate's Degree","Bachelor's Degree","Master's Degree","Master of Business Administrtion (M.B.A)","Juris Doctor (J.D)","Doctor of Medicine (M.D)","Doctor of Philosophy (Ph.D)","Engineer's Degree","Other"],i.hideOther=!0,i.$watch("degree",function(e,t){0==angular.isUndefined(e)&&e!==t&&("Other"==e?i.hideOther=!1:(i.hideOther=!0,$("#addEductionForm").find('input[name="otherDegree"]').val("")))}),i.$watch("qualification_edu",function(e,t){i.autoCompleteQualification(e)}),i.eduQualifications={},i.autoCompleteQualification=function(e){r.get(t.StaticOptionsAutoCompleteQualificationsApi+e).then(function(e){i.eduQualifications=e.data.data,i.eduQualifications.length?$("#addEductionForm .auto_complete_qualifications").removeClass("ng-hide"):$("#addEductionForm .auto_complete_qualifications").addClass("ng-hide")})},i.autoCompleteQualificationEdit=function(e,a){r.get(t.StaticOptionsAutoCompleteQualificationsApi+e).then(function(e){i.eduQualifications=e.data.data,i.eduQualifications.length?a.find(".auto_complete_qualifications").removeClass("ng-hide"):a.find(".auto_complete_qualifications").addClass("ng-hide")})},document.CancelEducationForm=function(e){var t=$(e).parents("form");t.prev().removeClass("hide"),t.addClass("hide")},document.qualificationWatch=function(e){var t=$(e).parents(".qualification_holder"),a=$(e).val();i.autoCompleteQualificationEdit(a,t)},document.degreesrWatch=function(e){"Other"==(e=$(e)).val()?e.next().removeClass("ng-hide"):(e.next().addClass("ng-hide"),e.next().find("input").val(""))},$(document).on("click",".addSelectedProvider",function(e){var t=$(this),a=t.attr("data-id");t.parents(".qualification_provider_holder").find('input[type="text"]').val(t.text()),t.parents(".qualification_provider_holder").find('input[type="text"]').attr("data-id",a),t.parent().addClass("ng-hide")}),$(document).on("click",".addAqualification",function(e){var t=$(this),a=t.attr("data-id");t.parents(".qualification_holder").find('input[type="text"]').val(t.text()),t.parents(".qualification_holder").find('input[type="text"]').attr("data-id",a),t.parent().addClass("ng-hide")}),$(document).on("keyup",".filterQualification",function(e){var t=$(this),a=t.val();a=a.toLowerCase();var o=t.parents(".qualification_provider_holder").find(".auto_complete_education_edu");o.hasClass("ng-hide")&&o.removeClass("ng-hide"),o.find("li").each(function(e,t){var o=$(t),i=o.text();-1==(i=i.toLowerCase()).indexOf(a)?o.hide():o.show()}),o.find("li:visible").length||o.hasClass("ng-hide")||o.addClass("ng-hide")}),$(document).on("keyup",".field_of_study",function(e){$(this).attr("data-id","")}),$("#pmvFileModalNew").on("hidden.bs.modal",function(){i.isPortfolioSupportingDoc&&(i.isPortfolioSupportingDoc=!1)}),i.modal_percent_value=0,i.showPortfolioDoc=!1,i.uploadPortfolio=function(){i.isPortfolioSupportingDoc=!0,o.openModal(i,"#pmvFileModalNew","portfolio")},$("#file_upload").change(function(){var e=$(this).attr("id");o.uploadFile(i,e,!1,"portfolio",2)}),i.file_change=function(){o.fileChange(i)},i.showPhone=!0,i.showAbout=!0,i.showRef=!0,i.showEd=!0,i.showVid=!0,i.showportfolio=!0,i.showResume=!0,i.showProfileImg=!0,i.$watchCollection("[aboutfield, references, educations, work_experience]",function(e,t){e!=t&&i.getStepData()},!0),i.$watch("questions",function(e,t){e.length!=t.length&&(i.getStepData(),angular.forEach(e,function(e,t){"references"==e?i.showRef=!1:"education"==e?i.showEd=!1:"icebreaker_video"==e?i.showVid=!1:"about_me"==e?i.showAbout=!1:"portfolio"==e?i.showportfolio=!1:"work_experience"==e?i.showExp=!1:"resume"==e?i.showResume=!1:"phone_number"==e?i.showPhone=!1:"profile_image"==e&&(i.showProfileImg=!1)}))}),i.sortDate=function(e){return new Date(e.date_x)},i.work_history=[],i.showExp=!0,r.get(t.StaticOptionWorkTypeApi).then(function(e){i.work_types_wh=e.data.data}),i.AddWorkHistoryForm=function(){i.showWorkHistoryForm=!0},i.CancelWorkHistory=function(){i.showWorkHistoryForm=!1},document.CancelWorkHistory=function(e){var t=$(e).parents("form");t.prev().removeClass("hide"),t.addClass("hide")},document.openWorkHistoryEdit=function(e){var t=$(e).attr("data-id");$(e).parents(".workhistory_item").find("form").removeClass("hide"),$(e).parents(".work_exp_holder").addClass("hide");var a=$("#form_whe_"+t),o=($("#form_whe_"+t).find('select[name="industry"]').val(),""),o="";a.find(".provider_container").html(""),angular.forEach(i.work_history,function(e,i){t==e.id&&(e.key_accountabilities.length?angular.forEach(e.key_accountabilities,function(e,t){o=0==t?'<div class="provider_container_con">                                            <div class="col-md-5" class="">                                                <input type="text" value="'+e+'" name="key_accountabilities[]" placeholder="Key Responsibilities" class="filterQualification" rows="3">                                            </div>                                             <div class="col-md-7 row">                                                <a class="add addNewProvider col-md-1 pvm-green"><span>+</span></a>                                            </div>                                            <div class="clearfix"></div>':'<div class="provider_container_con">                                                            <div class="col-md-5" class="">                                                <input type="text" value="'+e+'" name="key_accountabilities[]" placeholder="Key Responsibilities" class="filterQualification" rows="3">                                            </div>                                             <div class="col-md-7 row">                                                <a class="add addNewProvider col-md-1 pvm-green"><span>+</span></a>                                                <a class="add removeNewProvider col-md-1"><span>-</span></a>                                            </div>                                            <div class="clearfix"></div>',a.find(".provider_container").append(o)}):(o='<div class="provider_container_con">                                            <div class="col-md-5" class="">                                                <input type="text" value="" name="key_accountabilities[]" placeholder="Key Responsibilities" class="filterQualification" rows="3">                                            </div>                                             <div class="col-md-7 row">                                                <a class="add addNewProvider col-md-1 pvm-green"><span>+</span></a>                                            </div>                                            <div class="clearfix"></div>',a.find(".provider_container").html(o)),e.end_date||(a.find('input[name="end_date_whe"]').val(""),a.find("#wh_current_work").prop("checked",!0)))})},i.numbersOnly=function(e){var t=(e=e||window.event).which?e.which:e.keyCode;isNaN(String.fromCharCode(t))&&e.preventDefault()},i.delete=function(a){var o=t.WorkHistoryApi+"/"+a;r.delete(o).then(function(){var t=e(i.work_history,"id",a);-1!=t&&$("#wh"+a).slideToggle("slow",function(){i.work_history.splice(t,1)})})},i.$watchCollection("work_history",function(e,t){e.length!=t.length&&(0==e.length?i.NoWorkExp=!0:i.NoWorkExp=!1)}),document.openEducationEdit=function(e){var t=$(e).attr("data-id"),a=$(e).parents(".education_item");a.find("form").removeClass("hide"),a.find(".educations_holder").addClass("hide");var o=$("#edu_form_"+t),n=o.find('select[name="degree"]');angular.forEach(i.educations,function(e,a){t==e.id&&(null==e.degree?n.find("option:first").attr("selected",!0):i.getSelectedDegrees(e.degree)?angular.forEach(n.find("option"),function(t,a){(t=$(t)).val()==e.degree&&t.attr("selected",!0)}):(n.find("option:last").attr("selected",!0),n.next().removeClass("ng-hide")),e.completed_date||(o.find('input[name="completed_date"]').val(""),o.find("#edi_current_study").prop("checked",!0)))})},document.deleteProfileDoc=function(e){var a="",o=(e=$(e)).attr("data-type");if("video"==o?a=i.docs.icebreaker_video.doc_id:"resume"==o?a=i.docs.resume.doc_id:"portfolio"==o&&(a=i.docs.portfolio.doc_id),confirm("Want to delete your "+o+"?")&&a){var n=t.APIRoot+"candidate/doc/"+a;r.delete(n).then(function(e){"video"==o?delete i.docs.icebreaker_video:"resume"==o?delete i.docs.resume:"portfolio"==o&&delete i.docs.portfolio},function(){alert("error")})}},i.accountabilitiesLimit=3,$(document).on("click",".addNewProvider",function(e){if(3==$(this).parents(".provider_container").find(".provider_container_con").length)return alert("Max of "+i.accountabilitiesLimit+" only."),!1;$(this).parents(".provider_container").append('<div class="provider_container_con">                                            <div class="col-md-5" class="">                                <input type="text" name="key_accountabilities[]" placeholder="Key Responsibility" class="filterQualification" rows="3">                            </div>                             <div class="col-md-7 row">                                <a class="add addNewProvider col-md-1 pvm-green"><span>+</span></a>                                <a class="add removeNewProvider col-md-1"><span>-</span></a>                            </div>                            <div class="clearfix"></div></div>')}),$(document).on("click",".removeNewProvider",function(e){$(this).parents(".provider_container_con").remove()}),i.parseIndustriesData=function(e,t){var a=[];return angular.forEach(i.all_industries,function(o,i){-1!=e.indexOf(o.id)&&(a.push(o.id),angular.forEach(o.sub,function(e,o){-1!=t.indexOf(e.id)&&a.push(e.id)}))}),a},i.newToWorkForce=function(e){var a={data:{new_to_workforce:e}};r.put(t.profileApi,a).then(function(e){var t=e.config.data.data.new_to_workforce;i.showWorkHistoryForm=!1;var a=i.questions.indexOf("work_experience");-1!=a&&1==t?i.questions.splice(a,1):0==t&&i.questions.push("work_experience")},function(e){alert("some error")})},i.endDateDisable=!1,i.currentlyWorking=function(){i.currentlyWorkingField?(i.endDateDisable=!0,i.end_date=""):i.endDateDisable=!1},document.AddWorkHistory=function(e){var e=$(e),a={},o=[],n=[];$("#addworkhistoryform").serializeArray().map(function(e){"salary_range"==e.name?(e.name=null,e.value=null):"start_date_wka"==e.name||"end_date_wka"==e.name?a[e.name]=i.parse_view_date(e.value):"industries"==e.name?o.push(parseInt(e.value)):"subindustries"==e.name?n.push(parseInt(e.value)):a[e.name]=e.value}),a.wh_current_work&&(a.end_date_wka=null);var d=[];e.find("#provider_container").find('input[name="key_accountabilities[]"]').each(function(e,t){var a=$(t),o=a.val();o=o.toLowerCase(),a.val()&&d.push(a.val())});var s={data:{job_title:a.job_title_wka,industry:i.parseIndustriesData(o,n),company_name:a.company_name_wka,work_type:a.work_type,start_date:a.start_date_wka,end_date:a.end_date_wka,salary:a.salary,description:a.job_description,key_accountabilities:d}};r.post(t.WorkHistoryApi,s).then(function(t){if(201==t.status){alert("data saved"),e.find(':input:not([type="submit"])').val(""),e.find(':input:not([type="submit"])').removeClass("ng-touched"),e.find(':input:not([type="submit"])').addClass("ng-untouched"),e.find(':input[type="checkbox"]').prop("checked",!1),i.hidesubindustry=!0,angular.forEach(e.find("#provider_container").find(".provider_container_con"),function(e,t){t>0&&$(e).remove()}),e.find("#wh_current_work").prop("checked",!1),i.work_history.push(t.data.data),i.showWorkHistoryForm=!1;var a=i.questions.indexOf("work_experience");-1!=a&&i.questions.splice(a,1)}},function(e){alert("Error found: Please review form")})},i.showIndustry=function(e){e&&$filter("filter")(i.statuses,{value:e})},i.showWorkType=function(e){e&&$filter("filter")(i.work_types_wh,{value:e})},document.EditWorkHistory=function(e){var a=$(e),o=e.id;o=o.split("_"),o=o[2];var n=[],d=[],s=[];a.serializeArray().map(function(e){"industries"==e.name?d.push(parseInt(e.value)):"subindustries"==e.name?s.push(parseInt(e.value)):n[e.name]=e.value});var l=[];a.find('input[name="key_accountabilities[]"]').each(function(e,t){var a=$(t),o=a.val();o=o.toLowerCase(),a.val()&&l.push(a.val())}),n.wh_current_work&&(n.end_date_whe=null);var c={company_name:n.company_name_whe,work_type:n.work_type,industry:i.parseIndustriesData(d,s),start_date:i.parse_view_date(n.start_date_whe),end_date:i.parse_view_date(n.end_date_whe),salary:n.salary,key_accountabilities:l,description:n.job_description,job_title:n.job_title_whe};r.put(t.WorkHistoryApi+"/"+o,{data:c}).then(function(e){var t=e.data.data,n=a.prev();angular.forEach(i.work_history,function(e,a){o==e.id&&(i.work_history[a].company_name=t.company_name,i.work_history[a].job_title=t.job_title,i.work_history[a].salary=t.salary,i.work_history[a].description=t.description,i.work_history[a].key_accountabilities=t.key_accountabilities,i.work_history[a].start_date=t.start_date,i.work_history[a].end_date=t.end_date,i.work_history[a].display_date=t.display_date,angular.forEach(i.work_types_wh,function(e,o){t.work_type==e.id&&(i.work_history[a].work_type={id:t.work_type,display_name:e.display_name})}),i.work_history[a].industries_display=t.industries_display)}),n.removeClass("hide"),a.addClass("hide")},function(e){alert("Error found: Please review form")})},r.get(t.APIRoot+"static/options/industries/all").then(function(e){var t=e.data.data;i.all_industries=t}),document.hoverIndustry=function(e){var t=$(e).find('input[name="industries"]')[0];document.industry_selected(t)},document.industry_selected=function(e){(e=$(e)).parents("ul").find(".all_industry").removeClass("pvm-light-gray-background"),e.parent().addClass("pvm-light-gray-background");var t=e.parent().find(".sub_industry_multi_holder").clone();e.parents(".industry_multi_main").next().find(".sub_industry_holder").html(t),e.parents(".industry_multi_main").next().find(".sub_industry_holder").find(".sub_industry_multi_holder").removeClass("hide"),$(".sub_industry_multi_holder").TrackpadScrollEmulator()},i.onHoverSubIndustries=!0,document.showSubIndustries=function(e){i.onHoverSubIndustries=!0,e&&$(e).parent().find(".subindustry_multi_main").removeClass("hide")},document.hideSubIndustries=function(e){i.onHoverSubIndustries=!1,setTimeout(function(){0==i.onHoverSubIndustries&&$(e).find(".subindustry_multi_main").addClass("hide")},1500)},document.sub_industry_selected=function(e){var t=(e=$(e)).parents("ul").clone(),a=e.parents(".sub_industry_multi_holder").attr("data-id");e.parents(".subindustry_multi_main").prev().find("#industry_"+a+" > input").prop("checked",!0),e.parents(".subindustry_multi_main").prev().find(".sub_"+a).html(t)},document.sub_check_all=function(e){var t=$(e);t.parents("ul").next().find("input").prop("checked",e.checked),document.sub_industry_selected(t.parents("ul").next().find("input:first")[0])},document.subLabel=function(e){$(e).prev().click()},$(".section_container .tse-scroll-content").length&&$(".tse-scroll-content").scroll(function(){var e=window.location.hash.substring(1);if(0===$(this).scrollTop()){if(i.more_present){(e=e.split("/")).shift();var t=20*messageScrollCounter;i.getMessageThreads(e[1],t)}messageScrollCounter++}}),_)h="&job_id="+_;else var h="";if(i.nextStep)i.nextStep;else;i.notcomplete=!0,i.questions=[],i.SubmitRequirementCheck=function(){if(i.questions.length>0)i.profile_image||i.showResume||i.showportfolio||i.showVid?(location.reload(),i.notcomplete=!0):i.notcomplete=!1;else{var e={data:i.questions};r.post(t.CandidateRootApi+"/application/"+_+"/"+m+"/"+i.nextStep,e).then(function(e){i.questions=e.data.data,d.put("nextStep",e.data.data.next_step,{path:"/"}),n.location.href=a+"job/application?id="+m+h+"&next_step="+e.data.data.next_step})}}}else"application_questions"==i.nextStep?(i.preapply=!1,i.requirementcheck=!1,i.applicationquestions=!0,i.success=!1,i.fail=!1,i.notcomplete=!0,i.appQuestion=[],i.appQuestion.answer={},i.modal_percent_value=0,i.UploadQuestion=-1,i.uploadDoument=function(e){i.UploadQuestion=e,o.openModal(i,"#pmvFileModalNew","resume")},i.$watch("UploadQuestion",function(e,t){e!=t&&(i.selectedFieldId=e)}),$("#file_upload").change(function(){var e=$(this).attr("id");o.uploadFile(i,e,!1,"portfolio",2)}),i.file_save=function(e){function t(e){return e.replace(/^.*[\\\/]/,"")}$(e.currentTarget);i.is_candidate_question=!0,o.save(i),i.DocumentName=i.return_data.url;var a=i.DocumentName,n=t(a).split(".");angular.forEach(n,function(e,t){i.testitem=e});var r={doc_url:i.return_data.url,doc_file_type:i.testitem,doc_filename:t(a)};$("#file_data_"+i.UploadQuestion).removeClass("hide"),$("#file_data_"+i.UploadQuestion).find("a").attr("href",a),i.appQuestion.answer[i.selectedFieldId]=angular.fromJson(r)},i.file_change=function(){o.fileChange(i)},i.SubmitApplicationQuestion=function(){i.appQuestionSubmitted=[],angular.forEach(i.appQuestion.answer,function(e,t){if("object"==typeof e){var a=[];if(angular.forEach(e.multi,function(e,t){a.push(e)}),e.multi)o={question_id:parseInt(t),answer:a};if(!e.multi)o={question_id:parseInt(t),answer:e}}else var o={question_id:parseInt(t),answer:e};i.appQuestionSubmitted.push(o)});var e={data:i.appQuestionSubmitted};if(_)o="&job_id="+_;else var o="";r.post(t.CandidateRootApi+"/application/"+_+"/"+m+"/"+i.nextStep,e).then(function(e){if(i.questions=e.data.data,d.put("nextStep",e.data.data.next_step,{path:"/"}),i.questions.extra_data){var r=JSON.stringify(i.questions.extra_data);$.ajax({url:t.FileUploadUrl+"/update_question_data",data:{data:r},type:"post"}).done(function(){n.location.href=a+"job/application?id="+m+o})}else n.location.href=a+"job/application?id="+m+o}),i.last_id&&delete i.last_id}):"applied"==i.nextStep?(r.get(t.CandidateJobWatchlistApi+"/"+_).then(function(e){i.watchlistStat=e.data.data.watchlist}),i.preload=!0,i.watchList=function(e){i.preload=!1;$(e.currentTarget);r.post(t.CandidateJobWatchlistApi+"/"+_).then(function(e){i.preload=!0,i.watchlistStat=e.data.data.watchlist},function(e){})}):"rejected"==i.nextStep&&(i.follow_company=d.get("applied_company"),r.get(t.JobsApi+"/"+d.get("jobObjectId")).then(function(e){i.follow_company_link=a+"company/"+e.data.data.company.company_url}))}else i.noerror=!0,i.ErrorMsg="You haven't selected a job yet!";else window.location.href=a+"login";i.save_file=function(e){var a=$(e.currentTarget),o=a.attr("data-filename"),i=a.attr("data-folder");$.ajax({url:t.accountPage+"/upload_to_cloud",method:"post",data:{filename:o,folder:i,obkey:d.get("obkey")},dataType:"json",success:function(e){200==e.response&&($(".profile_img").attr("src",e.url),alert("Data has been saved."),a.attr("data-filename",""),a.attr("data-folder",""),"resume_save"==a.attr("id")&&$("#Form_my_file").text())}})},i.delete_old_file=function(e,a){$.ajax({url:t.accountPage+"/delete_recorded_video",method:"post",data:{filename:e,file_folder:a},success:function(e){$("#preview").attr("data-old_file",""),$("#preview").attr("data-file_folder",""),$("#preview_img_new").attr("data-old_file",""),$("#preview_img_new").attr("data-file_folder",""),$("#resume_save").attr("data-folder",""),$("#resume_save").attr("data-filename",""),$("#image_save").attr("data-folder",""),$("#image_save").attr("data-filename",""),$("#portfolio_save").attr("data-folder",""),$("#portfolio_save").attr("data-filename","")}})},i.video_upload_modal=function(e,a){var o=document.getElementById("Form_video_upload_modal");i.modal_percent_value=0,i.mobile_agent&&"file_upload"!=e?o=document.getElementById("mobile_camera_capture"):a&&(o=a.dataTransfer);var n=document.getElementById("preview"),r=document.getElementById("record"),d=(document.getElementById("stop"),document.getElementById("save"));if(d.disabled=!1,$("#save").hasClass("ng-hide")||$("#save").addClass("ng-hide"),$("#stop").hasClass("ng-hide")||$("#stop").addClass("ng-hide"),$("#record").hasClass("ng-hide")||$("#record").addClass("ng-hide"),$("#preview").attr("data-old_file")){var s=$("#preview").attr("data-old_file"),l=$("#preview").attr("data-file_folder");i.delete_old_file(s,l)}var c=o.files[0],s=($("#Form_video_upload_modal").data("ob_key"),(new Date).getTime()+"_"+c.name),p="Video";i.mobile_agent&&(s="camera_"+s,p="Camera");var u=["mp4","wma","mpg","mpeg","wmv","avi","mov"],m=s.lastIndexOf("."),f=s.substr(m+1).toLowerCase();if(-1==u.indexOf(f))return alert("Invalid Video file must be 'mp4','wma','mpg','mpeg','wav','avi' extension"),!1;if(Math.ceil(c.size/1048576)>150)return alert("Max video limit must be 150mb in size."),!1;var _=Math.ceil(1e6/c.size);_=_>1?1:_,n.src="",n.poster="",$("#modal_percent").hasClass("hidden")&&$("#modal_percent").removeClass("hidden");for(var v=0;v<_;v++)!function(e,a){var o=new XMLHttpRequest;o.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.ceil(e.loaded/e.total*100);i.modal_percent_value=t}},!1),o.addEventListener("readystatechange",function(e){if(4===this.readyState){$("#save").hasClass("ng-hide")&&$("#save").removeClass("ng-hide"),$("#modal_percent").hasClass("hidden")||$("#modal_percent").addClass("hidden");var t=s.split(" ");t=t.join("_"),n.src="assets/Uploads/"+p+"/"+t,n.play(),n.muted=!1,$("#save").attr("data-save_type","video"),d.disabled=!1,r.disabled=!0,$("#preview").attr("data-old_file",t),$("#preview").attr("data-file_folder",p)}});var l=1e6*a,c=l+(1e6-1);c>=e.size&&(c=e.size-1);var u="?file_folder="+p;o.open("POST",t.accountPage+"/video_upload_submit"+u,!0),o.setRequestHeader("Cache-Control","no-cache"),o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("X-File-Name",s),o.setRequestHeader("X-File-Size",e.size),o.setRequestHeader("X-File-Type",e.type),o.setRequestHeader("Content-Range",l+"-"+c+"/"+e.size),o.send(e)}(c,v)},i.video_upload=function(e){var a=document.getElementById("Form_video_upload"),o=a.files[0],n=d.get("obkey");e&&(o=e.dataTransfer.files[0]);var r=(new Date).getTime()+"_"+o.name,s=["mp4","wma","mpg","mpeg","wmv","avi","mov"],l=r.lastIndexOf("."),c=r.substr(l+1).toLowerCase();if(-1==s.indexOf(c))return alert("Invalid Video file must be 'mp4','wma','mpg','mpeg','wav','avi' extension"),!1;var p=Math.ceil(1e6/o.size);p=p>1?1:p,$("#video_progress").hasClass("ng-hide")&&$("#video_progress").removeClass("ng-hide");for(var u=0;u<p;u++)!function(e,o){var d=new XMLHttpRequest,s=d.upload;s.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.ceil(e.loaded/e.total*100);i.progressValue=t}},!1),s.addEventListener("error",function(e){$("#error").html(e)},!1),s.addEventListener("load",function(e){$("#error").html("uploading file to server, please wait...")},!1),d.addEventListener("readystatechange",function(e){4===this.readyState&&$.ajax({url:t.accountPage+"/save_uploaded_file",type:"post",data:{filename:r,doc_type:"icebreaker_video",ob_key:n,token_id:f},success:function(e){e?(i.progressValue=0,$("#video_progress").addClass("ng-hide"),$("#video_placeholder").attr("src","themes/bbt/images/placeholder_encoding.png")):alert("Internal error."),a.value=""}})});var l=1e6*o,c=l+(1e6-1);c>=e.size&&(c=e.size-1);d.open("POST",t.accountPage+"/video_upload_submit?file_folder=video",!0),d.setRequestHeader("Cache-Control","no-cache"),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("X-File-Name",r),d.setRequestHeader("X-File-Size",e.size),d.setRequestHeader("X-File-Type",e.type),d.setRequestHeader("Content-Range",l+"-"+c+"/"+e.size),d.send(e)}(o,u)},document.dropVideoModalNew=function(e){e.preventDefault(),i.ondragoverout_image=!1,i.ondragover_image=!0,i.new_video_upload_modal("",e)},document.allowDrop=function(e){e.preventDefault(),i.ondragoverout_image=!0,i.ondragover_image=!1},document.leaveIt=function(e){i.ondragoverout_image=!1,i.ondragover_image=!0},document.dropFileModalNew=function(e){e.preventDefault();var t=$(this).attr("id"),a=e,n=$("#pmvFileModalNew").attr("data-docFileType");o.uploadFile(i,t,a,n,3)},$("#image_upload_modal_new").change(function(){i.new_image_upload_modal()}),$("#video_upload_modal_new").change(function(){i.new_video_upload_modal("video_upload_modal_new")}),o.initParams(i),i.buttonsHideShow=function(e,t,a,o,n){i.record_btn=e,i.record_again_btn=t,i.stop_btn=a,i.save_btn=o,i.change_btn=n},i.sectionsHideShow=function(e,t){i.showSection1=e,i.showSection2=t},i.startVideo=function(){p(),i.isSafari||"Safari"==i.browserName?alert("Oh oh this feature is not yet supported by your browser. Drag and drop a video file instead, or use Chrome, Firefox or Microsoft Edge to record a video using your webcam."):o.startVideo(i)},i.recordVideo=function(){o.recordVideo(i)},i.stopVideo=function(){o.stopVideo(i)},i.videomgs=!1,i.saveVideo=function(){if("icebreaker_video"==i.doc_type)$("#video_placeholder").attr("src","themes/bbt/images/ajax-loader-video.gif").css({width:"106px","text-align":"center",margin:"20px 40px"}),o.saveVideo(i,"candidate_profile_edit");else{if("requirements_check"==i.nextStep){var e=i.questions.indexOf("icebreaker_video");i.questions.splice(e,1)}i.question_id&&($("#video_placeholder_"+i.question_id).attr("src","themes/bbt/images/ajax-loader-video.gif").css({width:"106px","text-align":"center",margin:"20px 40px"}),$(".videomgs"+i.question_id).show());var t={application_id:c("id"),question_id:i.question_id};o.saveVideo(i,"application",t)}},i.recordVideoAgain=function(){i.buttonsHideShow(!1,!0,!0,!0,!0)},i.openVideoModal=function(e,t){$("#pmvCameraModalNew").modal("show"),i.doc_type=t,i.question_id=e},i.changeVideo=function(){o.changeVideo(i)};var g=function(e,a,o){var i=new FormData;i.append("filename",o),i.append("audio-blob",e),i.append("video-blob",a);var n="?ob_key="+d.get("obkey")+"&doc_type=icebreaker_video&token_id="+f+"&file_folder=camera";w(t.accountPage+"/camera_upload_submit"+n,i,o)},w=function(e,t,a,o){var n=new XMLHttpRequest;n.upload.addEventListener("progress",function(e){e.lengthComputable&&(i.modal_percent_value=Math.ceil(e.loaded/e.total*100))},!1),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){if(i.modal_percent=!0,$("#pmvCameraModal").data("bs.modal")?($("#save").attr("data-recorded",a),$("#preview").attr("data-old_file",a),$("#preview").attr("data-file_folder","camera")):$("#pmvCameraModalNew").data("bs.modal")&&($("#save_btn").attr("data-recorded",a),$("#preview_new").attr("data-old_file",a),$("#preview_new").attr("data-file_folder","camera")),500==n.responseText)return alert("Error: Video not upload, please try again"),!1;b(a)}},n.open("POST",e),n.send(t)},b=function(e){var a=d.get("obkey");$.ajax({url:t.accountPage+"/save_uploaded_file",type:"post",data:{filename:e,ob_key:a,doc_type:"icebreaker_video",token_id:f},success:function(e){alert("Video has been saved."),$("#pmvCameraModal").data("bs.modal")?($("#save").attr("data-save_type",""),$("#save").attr("data-recorded",""),$("#pmvCameraModal").modal("hide")):$("#pmvCameraModalNew").data("bs.modal")&&($("#save_btn").attr("data-save_type",""),$("#save_btn").attr("data-recorded",""),$("#pmvCameraModalNew").modal("hide"))}})};$("#pmvCameraModalNew").on("hidden.bs.modal",function(){var e=JSON.parse(localStorage.getItem("VideoUploadResponseData"));if($(".successUpload").hide(),"question"==i.doc_type){if(angular.isDefined(e)&&null!=e){var t=e.data.question_id;$("input[name=test_"+t+"]").val(1),i.appQuestion.answer[t]=1,$("#video_placeholder_"+i.question_id).attr("src","themes/bbt/images/ajax-loader-video.gif").css({width:"106px","text-align":"center",margin:"20px 40px"}),$(".videomgs"+t).show(),localStorage.removeItem("VideoUploadResponseData")}}else if("icebreaker_video"==i.doc_type&&angular.isDefined(e)&&null!=e){$("#video_placeholder").attr("src","themes/bbt/images/ajax-loader-video.gif").css({width:"106px"});var a=i.questions.indexOf("icebreaker_video");i.questions.splice(a,1),i.videomgs=!0,localStorage.removeItem("VideoUploadResponseData")}}),i.new_video_upload_modal=function(e,t){if("question"==i.doc_type)var a="application",n={application_id:c("id"),question_id:i.question_id};else if("icebreaker_video"==i.doc_type)var a="candidate_profile_edit",n=null;o.video_upload(i,e,t,a,n)},i.open_camera_new=function(){i.isSafari?$("#pmvCameraModalNew").modal("show"):DetectRTC.hasMicrophone&&DetectRTC.hasWebcam||i.mobile_agent?$("#pmvCameraModalNew").modal("show"):($(".pvm-video-container-error").html(""),0==DetectRTC.hasMicrophone&&$(".pvm-video-container-error").append('<p class="text-danger">Microphone not set</p>'),0==DetectRTC.hasWebcam&&$(".pvm-video-container-error").append('<p class="text-danger">Camera not set</p>'),$("#pmvErrorMsg").modal("show"))},i.crop_data={w:240,h:240,x:80,y:0},i.startVideoImage=function(){p(),i.isSafari||"Safari"==i.browserName?alert("Oh oh this feature is not yet supported by your browser. Drag and drop an image instead, or use Chrome, Firefox or Microsoft Edge to capture an image using your webcam."):o.startVideoImage(i)},i.take_photo=function(){o.take_photo(i)},i.take_photo_again=function(){window.stream="",i.startVideoImage()},i.save_photo=function(){o.save_photo(i)},i.mobile_image_upload=function(){o.mobile_image_upload(i)},i.mobile_video_upload=function(){o.mobile_video_upload(i)},i.mobile_resume_upload=function(){o.mobile_resume_upload(i)},i.mobile_portfolio_upload=function(){o.mobile_portfolio_upload(i)},document.dropImageModalNew=function(e){e.preventDefault(),i.new_image_upload_modal(e)},i.new_image_upload_modal=function(e){o.new_image_upload_modal(i,e)};var y,k,C,x=document.getElementById("record"),q=document.getElementById("stop"),S=(document.querySelector("audio"),document.getElementById("preview")),E=(document.getElementById("preview_new"),document.getElementById("container"),document.getElementById("save"));navigator.mozGetUserMedia;x&&q&&E&&(i.open_camera=function(){DetectRTC.hasMicrophone&&DetectRTC.hasWebcam||i.mobile_agent?($("#modal_percent").hasClass("hidden")||$("#modal_percent").addClass("hidden"),$("#pmvCameraModal").modal("show"),$(".video_buttons").hasClass("ng-hide")||$(".video_buttons").addClass("ng-hide"),$("#pmvCameraModal").find(".video_buttons").each(function(e,t){(t=$(t)).hasClass("ng-hide")||t.addClass("ng-hide")}),$("#preview").attr("src",""),$("#preview").attr("data-old_file",""),$("#preview").attr("data-file_folder",""),$("#preview").attr("poster","themes/bbt/images/camera_poster.jpg")):($(".pvm-video-container-error").html(""),0==DetectRTC.hasMicrophone&&$(".pvm-video-container-error").append('<p class="text-danger">Microphone not set</p>'),0==DetectRTC.hasWebcam&&$(".pvm-video-container-error").append('<p class="text-danger">Camera not set</p>'),isSafari&&$(".pvm-video-container-error").html('<p class="text-danger">Your browser not supported.</p>'),$("#pmvErrorMsg").modal("show"))},x.onclick=function(){if(x.disabled=!0,E.disabled=!0,$("#record").attr("data-recorded")){var e=$("#record").attr("data-recorded");i.delete_old_file(e,"camera")}$("#modal_percent").hasClass("hidden")||$("#modal_percent").addClass("hidden");var t=function(){S.src=window.URL.createObjectURL(stream),S.play(),S.muted=!1,y=RecordRTC(stream,{onAudioProcessStarted:function(){k.startRecording()}}),k=RecordRTC(stream,{type:"video"}),y.startRecording(),q.disabled=!1};!window.stream&&navigator.getUserMedia({audio:!0,video:!0},function(e){window.stream=e,t()},function(e){alert(JSON.stringify(e,null,"\t"))}),window.stream&&t()},q.onclick=function(){$("#save").attr("data-save_type","camera"),x.disabled=!1,q.disabled=!0,E.disabled=!1,S.src="",C=Math.round(99999999*Math.random())+99999999,C="camera_"+C+".mp4",$("#record").attr("data-recorded",C),i.modal_percent_value=0,$("#preview").attr("poster",""),y.stopRecording(function(e){S.src=e,k.stopRecording(function(e){stream.stop(),window.stream=""})})},E.onclick=function(){var e=$(this),a=(document.getElementById("preview"),d.get("obkey"));if("camera"==e.attr("data-save_type")){$("#modal_percent").hasClass("hidden")&&$("#modal_percent").removeClass("hidden");if(!(n=$("#record").attr("data-recorded")))return!1;g(y.getBlob(),k.getBlob(),n)}else if("video"==e.attr("data-save_type")){var o=document.getElementById("Form_video_upload_modal"),n=$("#preview").attr("src"),r=n.lastIndexOf("/")+1;if(!(n=n.substr(r)))return!1;$.ajax({url:t.accountPage+"/save_uploaded_file",type:"post",data:{filename:n,doc_type:"icebreaker_video",ob_key:a,token_id:f},success:function(e){e?(i.progressValueModel=0,$("#pmvCameraModal").modal("hide")):alert("Internal error."),o.value=""}})}$("#preview").attr("src","")},$("#record_camera").click(function(){var e=$("#preview").attr("data-old_file"),t=$("#preview").attr("data-file_folder");i.delete_old_file(e,t),$("#preview").attr("src")&&($("#preview").attr("src",""),window.stream=""),$(".video_buttons").removeClass("ng-hide"),E.disabled=!0,x.disabled=!1,q.disabled=!0,!window.stream&&navigator.getUserMedia({audio:!0,video:!0},function(e){window.stream=e,S.src=window.URL.createObjectURL(e),S.play()},function(e){alert(JSON.stringify(e,null,"\t"))})}),$("#pmvCameraModal, #pmvCameraModalNew, #pmvImageModalNew, #pmvFileModalNew").on("hidden.bs.modal",function(){window.stream&&(stream.stop(),stream.getVideoTracks()[0].stop(),window.stream=""),o.initParams(i),$("#preview_new").attr("src",""),$("#preview_img_new").attr("src",""),$("#preview_img_new_holder").find(".jcrop-holder").length||$("#preview_img_new_holder").removeClass("jcrop_adjust_margin"),$("#preview_img_new_holderRE").find(".jcrop-holder").length||$("#preview_img_new_holderRE").removeClass("jcrop_adjust_margin")}),$("#pmvResumeModal").on("hidden.bs.modal",function(){var e=$("#resume_save");e.attr("data-filename")&&e.attr("data-folder")&&i.delete_old_file(e.attr("data-filename"),e.attr("data-folder"))}),$("#pmvResumeModal").on("show.bs.modal",function(){var e=$("#pmvResumeModal").find(".resume_buttons");e.hasClass("ng-hide")||e.addClass("ng-hide")}),$("#pmvImageModal").on("hidden.bs.modal",function(){var e=$("#image_save");e.attr("data-filename")&&e.attr("data-folder")&&i.delete_old_file(e.attr("data-filename"),e.attr("data-folder"))}),$("#pmvImageModal").on("show.bs.modal",function(){var e=$("#pmvImageModal").find(".resume_buttons");e.hasClass("ng-hide")||e.addClass("ng-hide")}),$("#pmvPortfolioModal").on("hidden.bs.modal",function(){var e=$("#portfolio_save");e.attr("data-filename")&&e.attr("data-folder")&&i.delete_old_file(e.attr("data-filename"),e.attr("data-folder"))}),$("#pmvPortfolioModal").on("show.bs.modal",function(){var e=$("#pmvPortfolioModal").find(".resume_buttons");e.hasClass("ng-hide")||e.addClass("ng-hide")}),i.open_file_modal=function(e){var t=$(e.currentTarget).attr("data-docFileType");o.openModal(i,"#pmvFileModalNew",t)},$("#file_upload").change(function(){var e=$(this).attr("id"),t=$("#pmvFileModalNew").attr("data-docFileType");o.uploadFile(i,e,!1,t,3,!0)}),i.file_change=function(){o.fileChange(i)})}])}(),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip(),$(".mydatepicker").datetimepicker({timepicker:!1,format:"d-m-Y"})});